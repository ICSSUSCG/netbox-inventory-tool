
# ğŸ§° NetBox YAML Generator

A Flask-based web application that extracts structured device information from manufacturer spec sheets (PDF or YAML) and generates validated, NetBox-compliant device-type YAML files.

This tool automates spec parsing, field formatting, file naming, and compliance checks according to the [NetBox Device Type Library Contribution Guide](https://github.com/netbox-community/devicetype-library/blob/master/CONTRIBUTING.md).

---

## ğŸ“¦ Features

- âœ… Upload **PDF spec sheets** or **YAML files**
- ğŸ¤– Uses **OpenAI (GPT-4o)** to parse PDFs and generate structured YAML
- âœ‚ï¸ **Splits multiple part numbers** into individual YAMLs
- ğŸ·ï¸ Enforces slug/filename conventions (`model` or `part_number`)
- ğŸ“‘ Adds autogenerated `comments` field with traceable source info
- ğŸ§¹ Removes unsupported fields, validates interfaces, adds defaults
- ğŸ“¦ Bundles multiple files into a downloadable `.zip`

---

## ğŸš€ Installation

### 1. Clone the repository
```bash
git clone https://github.com/your-org/netbox-yaml-generator.git
cd netbox-yaml-generator
```

### 2. (Recommended) Create and activate a virtual environment
```bash
python3 -m venv .venv
source .venv/bin/activate  # On Windows use: .venv\Scripts\activate
```

This ensures your environment is isolated and dependencies won't conflict with system-wide packages.

### 3. Install dependencies
```bash
pip install -r requirements.txt
```

**`requirements.txt` includes:**
- `Flask` (web framework)
- `PyMuPDF` (`fitz`) for PDF parsing
- `PyYAML` for YAML parsing/formatting
- `Werkzeug` for secure file handling
- `openai` for LLM integration

### 4. Run the application
```bash
python app.py
```
---

## ğŸŒ Usage

1. Visit `http://localhost:5000` in your browser.
2. Select your preferred **OpenAI model** (e.g., `gpt-4o`).
3. Upload a manufacturer PDF or YAML.
4. The app:
   - Parses the file
   - Validates and sanitizes fields
   - Generates one `.yml` per part number
5. Download the result as a `.yml` or `.zip`.

> ğŸ’¡ YAMLs are automatically validated using the internal NetBox scripts:
> `validate_config_standalone.py` and `validate_manifest_standalone.py`.

---

## ğŸ§  Field Rules & Validation

The app enforces the following:

| Field        | Behavior |
|--------------|----------|
| `slug`       | Normalized from `model`; capped to 2 hyphen segments |
| `filename`   | Derived from `model` or `part_number`, lowercased |
| `interfaces` | Unknown types fallback to `other`, `name` always required |
| `comments`   | Auto-tagged with filename origin |
| `device-bays`| Converts digital I/O bays into `inventory-items` |
| `null/empty` | Removed before saving |
| `multi-model`| Split into separate YAMLs |
| `validation` | YAMLs validated before download; invalid ones are blocked |

---

## ğŸ§ª Example Output

```yaml
model: SEL-311C-1
manufacturer: Schweitzer Engineering Laboratories, Inc.
slug: sel-311c-1
part_number: SEL-311C-1
comments: The SEL-311C-1 is a transmission relay... â€” Generated from 311C-1_DS.pdf using the NetBox YAML Generator
interfaces:
  - name: Ethernet
    type: 1000base-t
```

---

## ğŸ›¡ï¸ API Key Required

To use OpenAI functionality, provide your API key in the UI form before uploading a PDF.

Environment fallback:
```bash
export OPENAI_API_KEY=your-key-here
```

---

## ğŸ›  Project Structure

```
â”œâ”€â”€ app_v3.1.py                  # Latest application version
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html              # HTML interface
â”œâ”€â”€ output/                     # Generated YAMLs
â”œâ”€â”€ scripts/                    # Local validation modules
â”‚   â”œâ”€â”€ validate_config_standalone.py
â”‚   â””â”€â”€ validate_manifest_standalone.py
â”œâ”€â”€ requirements.txt
```

---

## ğŸ“¬ Contributing

If you'd like to contribute improvements or additional validation tools, please open an issue or pull request.


---

## ğŸ³ Docker Deployment

If you prefer to run the application using Docker:

### 1. Ensure you have the following files:
- `Dockerfile` â€” defines how the image is built
- `docker-compose.yml` â€” defines how the app runs and maps ports/volumes

### 2. Build and run the app using Docker Compose
```bash
docker-compose up --build
```

This will:
- Build the Docker image
- Launch the Flask app on `http://localhost:5000`
- Mount `./uploads` and `./output` as persistent volumes

### 3. Stop the app
```bash
docker-compose down
```

This is ideal for clean, repeatable deployments in development or production.



### ğŸ” Setting Your OpenAI API Key

Make sure to provide your API key before starting the container:
```bash
export OPENAI_API_KEY=your-api-key-here
docker-compose up --build
```

This key will be passed into the container using the `environment` block in `docker-compose.yml`.

---

### ğŸ“ .dockerignore

Add a `.dockerignore` file to prevent unnecessary files from being copied into the container:
```
__pycache__/
*.pyc
*.pyo
*.pyd
output/
uploads/
.venv
.env
.DS_Store
*.log
```

This keeps the container lightweight and avoids leaking local state or sensitive data.
